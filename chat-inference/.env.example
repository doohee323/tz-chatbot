# Chat Inference: Dify-free classifier + RAG + LLM
# Uses same Qdrant (Dify's DB) via RAG Backend API
#
# Note: chat-gateway/.env is used by chat-gateway. For local dev with chat-admin
# on the same port (8088), copy CHAT_GATEWAY_JWT_SECRET and CHAT_GATEWAY_API_KEY
# from chat-gateway/.env so tokens and API keys match.

# Auth
# JWT 서명용. 아무 랜덤 문자열 (생성: openssl rand -hex 32)
CHAT_GATEWAY_JWT_SECRET=0978434ca402b39e05c0527a3f1a4705e0c847525473faf55feec51fb192fba5
# 클라이언트(DrillQuiz/CoinTutor 프론트)가 GET /v1/chat-token 호출 시 X-API-Key로 보내는 값. 우리가 발급 (openssl rand -hex 16). dify_chatbot_token(Dify 임베드 토큰)과 별개.
# 쉼표로 여러 키 나열 가능. Jenkins/Secret에서 주입 시 동일 키를 프론트 빌드(VUE_APP_CHAT_GATEWAY_API_KEY)에도 넣음.
CHAT_GATEWAY_API_KEY=52fb806416b74b2214836a5c852410d9

# Optional: allow only these system_id values (comma-separated). Empty = allow all.
ALLOWED_SYSTEM_IDS=drillquiz,cointutor,cointutor2


# LLM (Gemini, same as Dify)
GEMINI_API_KEY=your-gemini-api-key
LLM_MODEL=gemini-2.5-flash
TEMPERATURE=0.7
MAX_TOKENS=512

# RAG Backend (Dify's DB via Qdrant). Required when classifier returns after_sales/products.
# - K8s 안에서 접근 시: http://rag-backend.rag.svc.cluster.local:8000 (클러스터 내부 주소)
# - 로컬에서 접근 시: RAG Backend가 K8s에 있으면 port-forward 후 localhost 사용.
#   어드민이 8000 사용 시 로컬 포트를 8001로 하세요:
#     kubectl port-forward svc/rag-backend 8001:8000 -n rag
#   그 다음 RAG_BACKEND_URL=http://localhost:8001 (어드민 안 쓸 때는 8000:8000, localhost:8000 가능)
RAG_BACKEND_URL=http://localhost:8001
RAG_COLLECTION_AFTER_SALES=rag_docs_cointutor
RAG_COLLECTION_PRODUCTS=rag_docs_cointutor
RAG_TOP_K=5

# Optional: MinIO for RAG quality logs (same bucket/schema as chat-gateway). Unset = skip.
# - K8s 안에서 접근 시: http://minio.devops.svc.cluster.local:9000
# - 로컬에서 접근 시: port-forward 후 사용. 예: kubectl port-forward svc/minio 9000:9000 -n devops
# MINIO_ENDPOINT=http://localhost:9000
# MINIO_ACCESS_KEY=
# MINIO_SECRET_KEY=
# MINIO_RAG_QUALITY_BUCKET=rag-quality-data
