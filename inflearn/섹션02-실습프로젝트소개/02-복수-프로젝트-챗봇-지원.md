# 02. 복수 프로젝트 챗봇 지원

tz-chatbot은 **단일 RAG·Dify 데모**가 아니라, **여러 앱(프로젝트)에 챗봇을 적용**할 수 있도록 설계되어 있습니다. 그를 위해 **DB**, **배치**, **관리 화면**이 있습니다.

## DB (chat_admin)

- **용도**: 시스템(앱) 등록·설정, 대화·메시지 저장·조회
- **공유**: chat-gateway와 chat-admin이 **동일 PostgreSQL DB `chat_admin`** 사용
- **역할**
  - **시스템(앱) 등록**: DrillQuiz, CoinTutor 같은 `system_id` 단위로 Dify URL·API Key·챗봇 토큰 등 저장
  - **대화·메시지**: gateway를 통해 오는 채팅을 DB에 저장·조회 (캐시/히스토리, 관리자 조회)

## 배치

- **Dify → DB 동기화**: chat-gateway의 **POST /v1/sync** 등으로 Dify 쪽 대화 목록·메시지를 주기적으로 DB로 가져옴 (cron 등으로 실행)
- **토픽별 RAG Ingestion CronJob**: MinIO `raw/cointutor/`, `raw/drillquiz/` 등 토픽별 경로를 주기적으로 읽어 임베딩 후 Qdrant에 적재
- **관리 화면에서 재색인 트리거**: chat-admin에서 “재색인” 버튼 등으로 해당 토픽의 RAG Ingestion Job을 수동 실행

## 관리 화면 (chat-admin)

- **시스템(앱) CRUD**: 새 챗봇 앱(system_id) 추가·수정·삭제, Dify URL·API Key·토큰 설정
- **채팅 조회**: system_id·user_id 기준으로 대화 목록·메시지 조회
- **RAG 문서 업로드·재색인**: 토픽별 MinIO 경로에 파일 업로드, 업로드 후 해당 토픽 RAG 재색인 트리거

## 정리

- **한 개의 RAG·Dify만** 쓰는 구조가 아니라, **여러 클라이언트 앱**을 등록하고 각각 Dify·RAG를 연결해 챗봇을 제공하는 **플랫폼** 형태입니다.
- 그걸 가능하게 하는 것이 **DB(시스템·대화)**, **배치(동기화·Ingestion)**, **관리 화면(chat-admin)** 입니다.
