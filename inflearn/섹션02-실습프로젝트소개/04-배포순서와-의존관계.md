# 04. 배포 순서와 의존 관계

## bootstrap.sh가 하는 설치 순서

1. **Ingress NGINX** (default NS) — TLS·라우팅. 다른 서비스가 Ingress를 쓰므로 먼저 필요
2. **MinIO** (devops NS) — `rag-docs` 버킷. RAG 문서 저장소이므로 RAG보다 먼저
3. **RAG 스택** (rag NS) — Qdrant, RAG Backend, Ingestion Job/CronJob. Dify가 RAG Backend URL을 호출하므로 Dify보다 먼저
4. **Dify** (dify NS) — 챗봇·RAG 도구 연동. RAG Backend URL·Tool 설정은 Dify 설치 후 웹 UI에서 설정

## bootstrap.sh에 포함되지 않는 것

- **chat-admin**, **chat-gateway**: 별도 배포
  - CI(`ci/k8s.sh`) 또는 Jenkins로 배포
  - **DB 선결 조건**: `chat_admin` DB가 PostgreSQL에 생성되어 있어야 함 (README의 Database setup 참고)

## 의존 관계 요약

```
Ingress ← (모든 HTTP/HTTPS 진입)
MinIO ← RAG Ingestion, chat-admin(파일 업로드)
Qdrant ← RAG Backend
RAG Backend ← Dify (Tool URL)
Dify ← chat-gateway
chat-gateway ← 클라이언트 앱, chat-admin(관리·JWT 등)
PostgreSQL(chat_admin) ← chat-gateway, chat-admin
```

- **시크릿**: RAG Backend·Ingestion은 `rag-ingestion-secret-cointutor`, `rag-ingestion-secret-drillquiz` 등 토픽별 Secret 필요. 없으면 Backend Pod가 기동하지 않거나 검색 시 오류가 날 수 있음 (rag/README.md 참고).
