# 슬라이드 04: 배포 순서와 의존 관계

## 슬라이드 내용 (한 장)

**bootstrap.sh 설치 순서**  
1. Ingress NGINX (default) — TLS·라우팅, 다른 서비스가 먼저 필요  
2. MinIO (devops) — rag-docs 버킷, RAG보다 먼저  
3. RAG 스택 (rag) — Qdrant, Backend, Ingestion. Dify가 Backend URL 호출하므로 Dify보다 먼저  
4. Dify (dify) — Backend URL·Tool은 설치 후 웹 UI에서 설정

**bootstrap에 없음**  
• chat-admin, chat-gateway → CI(k8s.sh) 또는 Jenkins 별도 배포  
• 선결 조건: PostgreSQL에 `chat_admin` DB 생성 (README Database setup 참고)

**의존 관계**  
Ingress ← 모든 HTTP/HTTPS / MinIO ← RAG Ingestion, chat-admin / Qdrant ← RAG Backend / RAG Backend ← Dify / Dify ← chat-gateway / chat-gateway ← 클라이언트·chat-admin / PostgreSQL(chat_admin) ← chat-gateway, chat-admin

**시크릿**: RAG Backend·Ingestion은 토픽별 Secret(rag-ingestion-secret-cointutor 등) 필요. 없으면 Backend Pod 기동 실패·검색 오류 가능.

---

## 발표 노트

배포 순서와 의존 관계를 정리하겠습니다.

bootstrap.sh가 하는 설치 순서는 네 단계입니다. 첫째, Ingress NGINX를 default 네임스페이스에 올립니다. TLS와 라우팅을 담당하므로 다른 서비스가 Ingress를 쓰려면 먼저 필요합니다. 둘째, MinIO를 devops 네임스페이스에 올립니다. rag-docs 버킷이 RAG 문서 저장소이므로 RAG 스택보다 먼저 있어야 합니다. 셋째, RAG 스택을 rag 네임스페이스에 올립니다. Qdrant, RAG Backend, Ingestion Job·CronJob입니다. Dify가 RAG Backend URL을 호출하기 때문에 Dify보다 먼저 설치합니다. 넷째, Dify를 dify 네임스페이스에 올립니다. RAG Backend URL이나 Tool 설정은 Dify 설치 후 웹 UI에서 합니다.

chat-admin과 chat-gateway는 bootstrap에 포함되지 않습니다. CI의 k8s.sh나 Jenkins로 별도 배포하고, 그 전에 PostgreSQL에 chat_admin DB를 생성해 두어야 합니다. README의 Database setup을 참고하면 됩니다.

의존 관계를 간단히 말하면, Ingress는 모든 HTTP·HTTPS 진입을 받고, MinIO는 RAG Ingestion과 chat-admin 파일 업로드에서 사용되고, Qdrant는 RAG Backend가 쓰고, RAG Backend는 Dify가 Tool URL로 호출하고, Dify는 chat-gateway가 호출하고, chat-gateway는 클라이언트 앱과 chat-admin에서 사용됩니다. PostgreSQL의 chat_admin DB는 chat-gateway와 chat-admin이 같이 씁니다.

한 가지 더, RAG Backend와 Ingestion은 rag-ingestion-secret-cointutor, rag-ingestion-secret-drillquiz 같은 토픽별 Secret이 필요합니다. 이게 없으면 Backend Pod가 기동하지 않거나 검색 시 API key 오류가 날 수 있으니 rag/README.md를 보고 설치 직후 Secret을 만들어 두시면 됩니다.
