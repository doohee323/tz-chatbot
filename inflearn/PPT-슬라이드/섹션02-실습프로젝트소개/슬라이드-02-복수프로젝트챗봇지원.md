# 슬라이드 02: 복수 프로젝트 챗봇 지원

## 슬라이드 내용 (한 장)

**DB (chat_admin)**  
• 시스템(앱) 등록·설정, 대화·메시지 저장·조회  
• chat-gateway와 chat-admin이 **동일 PostgreSQL DB `chat_admin`** 공유  
• system_id 단위로 Dify URL·API Key·챗봇 토큰 저장; gateway 경유 채팅 저장·조회

**배치**  
• **Dify → DB 동기화**: POST /v1/sync으로 Dify 대화·메시지를 주기적으로 DB로 (cron 등)  
• **토픽별 RAG Ingestion CronJob**: MinIO raw/cointutor, raw/drillquiz 등 주기 읽기 → 임베딩 → Qdrant  
• **관리 화면 재색인**: chat-admin에서 버튼으로 해당 토픽 RAG Ingestion Job 수동 실행

**관리 화면 (chat-admin)**  
• 시스템(앱) CRUD, 채팅 조회(system_id·user_id), RAG 문서 업로드·재색인 트리거

**정리**: 한 개 RAG·Dify가 아니라 **여러 클라이언트 앱** 등록 후 각각 Dify·RAG 연결하는 **플랫폼**. 가능하게 하는 것이 DB·배치·관리 화면.

---

## 발표 노트

tz-chatbot은 단일 RAG·Dify 데모가 아니라, 여러 앱에 챗봇을 적용할 수 있도록 설계되어 있습니다. 그를 위해 DB, 배치, 관리 화면 세 가지가 있습니다.

먼저 DB입니다. chat_admin이라는 PostgreSQL DB를 chat-gateway와 chat-admin이 같이 씁니다. 용도는 시스템, 즉 앱 등록과 설정, 그리고 대화·메시지 저장과 조회입니다. DrillQuiz, CoinTutor 같은 system_id 단위로 Dify URL, API Key, 챗봇 토큰을 저장하고, gateway를 통해 오는 채팅을 DB에 저장해서 캐시나 히스토리, 관리자 조회에 씁니다.

두 번째는 배치입니다. Dify에서 DB로 동기화할 때는 chat-gateway의 POST /v1/sync를 cron 등으로 주기 호출해서 Dify 쪽 대화 목록과 메시지를 DB로 가져옵니다. 토픽별 RAG Ingestion은 CronJob으로 MinIO의 raw/cointutor, raw/drillquiz 같은 경로를 주기적으로 읽어서 임베딩 후 Qdrant에 넣습니다. 또 관리 화면에서 재색인 버튼을 누르면 해당 토픽의 RAG Ingestion Job을 수동으로 한 번 실행할 수 있습니다.

세 번째는 관리 화면, chat-admin입니다. 여기서 새 챗봇 앱, system_id를 추가·수정·삭제하고, Dify URL·API Key·토큰을 설정합니다. system_id와 user_id로 대화 목록과 메시지를 조회하고, 토픽별 MinIO 경로에 RAG 문서를 업로드한 뒤 재색인을 트리거합니다.

정리하면, 한 개의 RAG와 Dify만 쓰는 구조가 아니라 여러 클라이언트 앱을 등록하고 각각 Dify와 RAG를 연결해 챗봇을 제공하는 플랫폼 형태입니다. 그걸 가능하게 하는 것이 DB, 배치, 관리 화면입니다.
