# 슬라이드 05: 자주 나는 오류와 해결

## 슬라이드 내용 (한 장)

**RAG Backend / Ingestion**
• "API key not valid" → 토픽 Secret 없음 또는 GEMINI_API_KEY 오류 → Secret 생성·수정 후 Backend 재시작
• MinIO 연결 실패 → MINIO_ACCESS_KEY/SECRET_KEY, 엔드포인트 확인
• Qdrant 연결 실패 → Service 이름·포트, 네트워크 정책, 컬렉션 생성 여부 확인

**Dify**
• 도구 호출 타임아웃 → RAG Backend URL (K8s 내부 주소), Pod Running 확인
• 401/403 → Dify API Key가 gateway·admin에 올바르게 설정됐는지 확인

**chat-gateway / chat-admin**
• DB 연결 실패 → chat_admin DB 생성 여부, POSTGRES_* 환경변수 확인
• JWT invalid → CHAT_GATEWAY_JWT_SECRET이 gateway·발급 측에서 동일한지 확인
• CORS / iframe → ALLOWED_CHAT_TOKEN_ORIGINS, ALLOWED_SYSTEM_IDS 허용 목록 확인

**Ingress / TLS**
• Certificate not Ready → cert-manager 로그, ACME 검증, 80/443·DNS 확인
• 502 Bad Gateway → Backend Service·Pod 존재, Ready 상태 확인

---

## 발표 노트

운영하면서 자주 마주치는 오류들입니다. RAG Backend 또는 Ingestion Job에서 "API key not valid"라는 오류가 나면, 해당 토픽의 Secret이 없거나 GEMINI_API_KEY(또는 OPENAI_API_KEY)가 잘못된 겁니다. Secret을 생성하거나 수정한 뒤에는 Backend Pod를 재시작해야 새로운 Secret 값을 읽습니다.

MinIO 연결 실패는 MinIO가 정상 작동하지 않거나 Secret의 접근 키가 틀렸을 때입니다. MINIO_ACCESS_KEY와 MINIO_SECRET_KEY, 그리고 엔드포인트 URL이 맞는지 확인하세요. Qdrant 연결 실패는 Service 이름이 정확한지, 포트가 맞는지, 네트워크 정책에서 차단되지 않는지 확인하고, 필요한 컬렉션이 생성되었는지도 봐야 합니다.

Dify에서 도구 호출이 타임아웃되면, RAG Backend의 URL이 K8s 클러스터 내부 주소(예: http://rag-backend.rag:8000)로 설정되었는지 확인하고, Backend Pod가 Running 상태인지 봅니다. Dify 인증 오류(401/403)는 API Key가 chat-gateway와 chat-admin에 올바르게 설정되지 않았을 때입니다.

chat-gateway와 chat-admin의 DB 연결 실패는 chat_admin DB가 생성되지 않았거나, POSTGRES_HOST, PORT, USER, PASSWORD 같은 환경변수가 틀렸을 때입니다. JWT invalid 오류는 CHAT_GATEWAY_JWT_SECRET이 gateway와 JWT를 발급하는 쪽(드릴퀴즈 백엔드 등)에서 동일하지 않을 때 발생합니다. CORS나 iframe 오류는 ALLOWED_CHAT_TOKEN_ORIGINS나 ALLOWED_SYSTEM_IDS 같은 허용 목록을 확인해야 합니다.

Ingress와 TLS 관련해서는, Certificate이 Ready가 안 되면 cert-manager의 로그를 보고 ACME 검증이 실패했는지 확인합니다. 도메인의 DNS가 정상 설정되었는지, 80번과 443번 포트가 열려 있는지도 확인하세요. 502 Bad Gateway는 Backend 서비스나 Pod가 없거나 Ready 상태가 아닐 때 나옵니다. Pod 로그와 describe, 이벤트를 차근차근 확인하면 대부분 해결됩니다.
