# 06. 서버 배포 방법

## CI 스크립트 (k8s.sh)

- **chat-admin**: `chat-admin/ci/k8s.sh` — 브랜치에 따라 매니페스트 치환 후 `kubectl apply`
- **chat-gateway**: `chat-gateway/ci/k8s.sh` — 동일
- 보통 **GIT_BRANCH** 등으로 네임스페이스·Secret 접미사(-main, -qa, -dev)를 바꿈
- 로컬에서 실행: `cd chat-admin && ./ci/k8s.sh` (또는 ci 폴더 내 스크립트 확인)

## Jenkins

- **Multibranch Pipeline** 등으로 저장소 브랜치별 빌드·배포
- Push 시 웹훅으로 Jenkins가 빌드 → 이미지 빌드 → K8s 배포 (매니페스트는 ci/*.yaml 사용)
- 브랜치별 네임스페이스: main → devops, dev → devops-dev, qa → devops 또는 devops-qa (저장소·Jenkinsfile 확인)

## 배포 순서

1. **인프라**: Ingress, MinIO, RAG, Dify (bootstrap.sh)
2. **DB**: PostgreSQL에 `chat_admin` 생성, 접속 정보 준비
3. **Secret**: chat-admin·chat-gateway용 Secret (DB 비밀번호, Dify API Key, JWT Secret 등) 생성
4. **앱 배포**: k8s.sh 또는 Jenkins로 chat-admin·chat-gateway Deployment 적용
5. **Ingress**: admin·gateway용 Ingress 규칙이 있으면 적용

자세한 변수·폴더 구조는 각 `ci/` 디렉터리와 Jenkinsfile을 참고하세요.
