# 02. 복수 앱 지원: DB와 배치

## DB (chat_admin)

- **PostgreSQL** DB `chat_admin`을 chat-gateway와 chat-admin이 **공유**
- **chat_systems**: 시스템(앱)별 설정 — system_id, Dify URL·API Key·챗봇 토큰, allowed_origins 등
- **대화·메시지**: gateway를 통해 오는 채팅을 저장 (캐시/히스토리), 관리자가 조회
- K8s 배포 시 POSTGRES_* 환경변수 또는 Secret으로 DB 접속 정보 주입

## 배치

- **Dify → DB 동기화**: chat-gateway의 **POST /v1/sync** 를 주기적으로 호출(cron 등)해 Dify 쪽 대화·메시지를 DB로 가져옴
- **RAG Ingestion CronJob**: 토픽별로 MinIO → Qdrant 재색인 (섹션 07·08)
- **관리 화면에서 재색인 트리거**: chat-admin에서 버튼 클릭 시 해당 토픽의 RAG Ingestion Job을 한 번 생성 (kubectl create job --from=cronjob/...)

이렇게 DB로 “어떤 앱이 있고, 어떤 대화가 있는지”를 관리하고, 배치로 동기화·재색인을 돌려 **복수 앱**을 운영합니다.
