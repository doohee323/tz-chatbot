# 07-2. 실습: 재색인 실행

## 목표

- 토픽별 RAG Ingestion을 **수동으로 한 번** 실행해, MinIO 문서가 Qdrant에 반영되는지 확인합니다.

## 전제

- MinIO `rag-docs/raw/cointutor/` 또는 `raw/drillquiz/` 아래에 테스트용 문서(예: .md, .txt)가 있음
- 해당 토픽의 Secret(`rag-ingestion-secret-cointutor` 등)이 생성되어 있음

## 단계

### 1. CronJob에서 1회 Job 생성 (CoinTutor 예)

```bash
kubectl create job -n rag ingest-cointutor-1 --from=cronjob/rag-ingestion-cronjob-cointutor
```

- Job 이름은 자유 (예: ingest-cointutor-1). 중복 이름이면 안 되므로 이미 있으면 다른 이름 사용

### 2. Job 완료 대기·로그 확인

```bash
kubectl get jobs -n rag
kubectl logs -n rag job/ingest-cointutor-1 -f
```

- 정상이면 MinIO에서 파일 읽기 → 청킹·임베딩 → Qdrant upsert 로그가 나오고 Job이 Completed로 바뀜
- 실패 시 Secret(API 키)·MinIO 접근·네트워크 등을 확인

### 3. DrillQuiz 쪽도 동일하게 (선택)

```bash
kubectl create job -n rag ingest-drillquiz-1 --from=cronjob/rag-ingestion-cronjob-drillquiz
kubectl logs -n rag job/ingest-drillquiz-1 -f
```

### 4. 검증

- RAG Backend에 검색 요청을 보내 해당 토픽에서 결과가 나오는지 확인
- 또는 Dify에서 해당 앱의 RAG 도구를 호출해 보기 (섹션 09 실습과 연계)

재색인 후에는 Dify·chat-gateway를 통해 실제 채팅으로 RAG 응답을 확인할 수 있습니다.
