# 05. 자주 나는 오류와 해결

## RAG Backend / Ingestion

- **"API key not valid"**: 해당 토픽의 `rag-ingestion-secret-*` 이 없거나, GEMINI_API_KEY(또는 OPENAI_API_KEY)가 잘못됨. Secret 생성·수정 후 Backend 재시작.
- **MinIO 연결 실패**: MinIO가 devops NS에 있고, Secret의 MINIO_ACCESS_KEY/MINIO_SECRET_KEY, 엔드포인트 URL이 맞는지 확인.
- **Qdrant 연결 실패**: Qdrant Service 이름·포트, 네트워크 정책 확인. 컬렉션이 생성되었는지 확인.

## Dify

- **도구 호출 타임아웃**: RAG Backend URL이 K8s 내부 주소인지, Pod가 Running인지 확인.
- **401/403**: Dify API Key가 chat-gateway·chat-admin에 올바르게 설정되었는지 확인.

## chat-gateway / chat-admin

- **DB 연결 실패**: `chat_admin` DB가 생성되었는지, POSTGRES_* 환경변수(또는 Secret)가 맞는지 확인.
- **JWT invalid**: CHAT_GATEWAY_JWT_SECRET이 gateway와 JWT 발급 측에서 동일한지 확인.
- **CORS / iframe**: ALLOWED_CHAT_TOKEN_ORIGINS, ALLOWED_SYSTEM_IDS 등 허용 목록 확인.

## Ingress / TLS

- **Certificate not Ready**: cert-manager 로그, ACME 검증 실패 사유 확인. 80/443 포트·도메인 DNS 확인.
- **502 Bad Gateway**: Backend Service·Pod가 존재하고 Ready인지 확인.

위 항목으로 해결되지 않으면 Pod 로그·describe·이벤트를 단계별로 확인하세요.
